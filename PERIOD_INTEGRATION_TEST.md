# 기수별 인증 기간 통합 테스트 체크리스트

## 개요
이 문서는 T-013부터 T-018까지 구현된 기수별 인증 기간 관리 기능의 통합 테스트 체크리스트입니다.

## 테스트 환경
- **프로덕션 URL**: https://asc-challenge-platform.vercel.app
- **테스트 날짜**: 2025-10-13
- **관련 기능**: periods 테이블, 인증 기간 검증, UI 제어

---

## 1️⃣ 데이터베이스 스키마 검증 (T-014)

### ✅ periods 테이블 확인
- [ ] `periods` 테이블이 Supabase에 존재하는가?
- [ ] 필수 컬럼이 모두 있는가?
  - [ ] `id` (UUID, PK)
  - [ ] `term_number` (정수, NOT NULL)
  - [ ] `start_date` (날짜, NOT NULL)
  - [ ] `end_date` (날짜, NOT NULL)
  - [ ] `is_active` (boolean, default: true)
  - [ ] `description` (텍스트, nullable)
  - [ ] `created_by` (UUID, FK to users)
  - [ ] `created_at`, `updated_at` (타임스탬프)

### ✅ certifications 테이블 업데이트 확인
- [ ] `period_id` 컬럼이 추가되었는가? (UUID, nullable, FK to periods)
- [ ] 외래키 제약조건이 올바르게 설정되었는가?

### ✅ RLS 정책 확인
- [ ] periods 테이블에 적절한 RLS 정책이 있는가?
  - [ ] 모든 사용자가 활성 기수를 읽을 수 있는가?
  - [ ] 관리자만 기수를 생성/수정할 수 있는가?

### ✅ 트리거 및 제약조건
- [ ] 한 번에 하나의 활성 기수만 존재하도록 제약조건이 있는가?
- [ ] `start_date < end_date` 검증이 있는가?

---

## 2️⃣ 전체 리셋 기능 검증 (T-013)

### ✅ UI 확인 (/admin/certifications)
- [ ] "전체 리셋" 섹션이 표시되는가?
- [ ] React Hook Form으로 구현된 폼이 있는가?
- [ ] 필수 필드가 모두 있는가?
  - [ ] `beforeDate` (인증 삭제 기준일)
  - [ ] `seasonStartDate` (새 기수 시작일)
  - [ ] `seasonEndDate` (새 기수 종료일)
  - [ ] `reason` (리셋 사유)

### ✅ 유효성 검증
- [ ] 시작일이 종료일보다 이후일 때 에러가 표시되는가?
- [ ] 필수 필드가 비어있을 때 제출이 차단되는가?
- [ ] 날짜 포맷이 올바른가?

### ✅ API 동작 (/api/admin/certifications/reset)
- [ ] POST 요청이 성공하는가?
- [ ] 다음 작업들이 순서대로 실행되는가?
  1. [ ] 기준일 이전 인증 데이터를 `certifications_backup`에 백업
  2. [ ] 기준일 이전 인증 데이터를 `certifications`에서 삭제
  3. [ ] 모든 사용자의 `is_participant` = false 업데이트
  4. [ ] 기존 활성 기수를 `is_active` = false로 업데이트
  5. [ ] 새로운 기수 생성 (`term_number` 자동 증가)

### ✅ 응답 확인
- [ ] 성공 메시지와 함께 200 상태 코드를 반환하는가?
- [ ] 응답에 다음 정보가 포함되는가?
  - [ ] 백업된 인증 수
  - [ ] 삭제된 인증 수
  - [ ] 업데이트된 사용자 수
  - [ ] 새로 생성된 기수 정보

---

## 3️⃣ 인증 기간 검증 로직 (T-015)

### ✅ submitCertification 함수 (/src/lib/supabase/database.ts)
- [ ] 활성 기수를 조회하는가?
- [ ] 인증 날짜가 활성 기수 기간 내에 있는지 검증하는가?
- [ ] 기간 외 날짜일 때 적절한 에러 메시지를 throw 하는가?
- [ ] `period_id`가 자동으로 할당되는가?

### ✅ 에러 메시지
- [ ] 인증 날짜가 시작일 이전: "N기는 YYYY-MM-DD부터 시작됩니다"
- [ ] 인증 날짜가 종료일 이후: "N기는 YYYY-MM-DD에 종료되었습니다"

### ✅ 성공 케이스
- [ ] 기간 내 인증이 정상적으로 저장되는가?
- [ ] `period_id`가 올바르게 설정되는가?

---

## 4️⃣ 프론트엔드 권한 제어 (T-016)

### ✅ useActivePeriod 훅
- [ ] 활성 기수 데이터를 가져오는가?
- [ ] React Query로 캐싱되는가?
- [ ] 로딩 상태가 올바른가?

### ✅ isWithinActivePeriod 헬퍼 함수
- [ ] 날짜가 기간 내에 있는지 정확히 검증하는가?
- [ ] 적절한 메시지를 반환하는가?

### ✅ 인증 페이지 UI (/certify/[trackType]/page.tsx)
- [ ] 인증 날짜 변경 시 실시간으로 검증되는가?
- [ ] 기간 외 날짜 선택 시:
  - [ ] 노란색 경고 메시지가 표시되는가?
  - [ ] 빨간색 에러 박스가 표시되는가?
  - [ ] 제출 버튼이 비활성화되는가?
  - [ ] 버튼에 tooltip이 표시되는가?
- [ ] 기간 내 날짜 선택 시:
  - [ ] 경고 메시지가 숨겨지는가?
  - [ ] 제출 버튼이 활성화되는가?

---

## 5️⃣ 기수 수정 기능 (T-017)

### ✅ 관리자 설정 페이지 (/admin/settings)
- [ ] "기수 관리" 섹션이 표시되는가?
- [ ] 현재 활성 기수 정보가 표시되는가?
  - [ ] 기수 번호
  - [ ] 시작일
  - [ ] 종료일
  - [ ] 설명
- [ ] [수정] 버튼이 있는가?

### ✅ 수정 Dialog
- [ ] [수정] 버튼 클릭 시 Dialog가 열리는가?
- [ ] 현재 값이 자동으로 입력되어 있는가?
- [ ] 시작일, 종료일, 설명 필드가 있는가?
- [ ] 날짜 유효성 검증이 작동하는가?
  - [ ] 종료일 < 시작일 일 때 에러 표시

### ✅ API 동작 (/api/admin/periods/update)
- [ ] PUT 요청이 성공하는가?
- [ ] 관리자 권한이 확인되는가?
- [ ] periods 테이블이 업데이트되는가?
- [ ] 성공 시 토스트 알림이 표시되는가?
- [ ] React Query가 자동으로 데이터를 refetch 하는가?

### ✅ UI 업데이트
- [ ] Dialog가 자동으로 닫히는가?
- [ ] 관리자 설정 페이지의 기수 정보가 즉시 업데이트되는가?
- [ ] 인증 페이지의 기간 검증이 새로운 기간으로 적용되는가?

---

## 6️⃣ 기수 배너 표시 (T-018)

### ✅ PeriodBanner 컴포넌트
- [ ] 활성 기수가 있을 때 배너가 표시되는가?
- [ ] 활성 기수가 없을 때 배너가 숨겨지는가?

### ✅ 배너 내용
- [ ] 기수 번호 (N기 챌린지) 배지가 표시되는가?
- [ ] 시작일과 종료일이 한국어 포맷(yyyy.MM.dd)으로 표시되는가?
- [ ] 남은 일수가 표시되는가?

### ✅ 색상 코딩
- [ ] 정상 (7일 초과 남음):
  - [ ] 파란색 배경 (bg-blue-50)
  - [ ] CalendarDays 아이콘
  - [ ] "N일 남음" 텍스트
- [ ] 경고 (7일 이하 남음):
  - [ ] 노란색 배경 (bg-yellow-50)
  - [ ] Clock 아이콘
  - [ ] "마감 N일 전" 텍스트
- [ ] 종료 (기간 종료):
  - [ ] 빨간색 배경 (bg-red-50)
  - [ ] AlertCircle 아이콘
  - [ ] "종료됨" 텍스트

### ✅ 페이지 통합
- [ ] 홈 페이지 (/)
- [ ] 트랙 선택 (/certify)
- [ ] 리더보드 (/leaderboard)
- [ ] 프로필 (/profile)

---

## 7️⃣ 통합 시나리오 테스트

### 시나리오 1: 새 기수 시작
1. [ ] 관리자가 `/admin/certifications`에 접속
2. [ ] 전체 리셋 폼 작성
   - [ ] beforeDate: 2024-12-31
   - [ ] seasonStartDate: 2025-01-01
   - [ ] seasonEndDate: 2025-12-31
   - [ ] reason: "2기 시작"
3. [ ] [전체 리셋] 버튼 클릭
4. [ ] 성공 메시지 확인
5. [ ] 새 기수가 생성되었는지 확인 (2기)
6. [ ] 모든 페이지에서 배너가 "2기 챌린지" 표시 확인

### 시나리오 2: 기간 내 인증
1. [ ] 사용자가 `/certify/short-form` 접속
2. [ ] 배너에서 활성 기수 기간 확인
3. [ ] 기간 내 날짜 선택 (예: 2025-10-13)
4. [ ] 경고 메시지 없음 확인
5. [ ] 제출 버튼 활성화 확인
6. [ ] 인증 URL 입력 후 제출
7. [ ] 인증 성공 확인

### 시나리오 3: 기간 외 인증 차단
1. [ ] 사용자가 `/certify/short-form` 접속
2. [ ] 기간 외 날짜 선택 (예: 2024-12-01)
3. [ ] 노란색 경고 메시지 표시 확인
4. [ ] 빨간색 에러 박스 표시 확인
5. [ ] 제출 버튼 비활성화 확인
6. [ ] 제출 시도 시 차단 확인

### 시나리오 4: 기수 기간 수정
1. [ ] 관리자가 `/admin/settings` 접속
2. [ ] "기수 관리" 섹션에서 현재 기수 확인
3. [ ] [수정] 버튼 클릭
4. [ ] Dialog에서 종료일을 2025-06-30으로 변경
5. [ ] [저장] 버튼 클릭
6. [ ] 성공 토스트 확인
7. [ ] 기수 정보가 즉시 업데이트되는지 확인
8. [ ] `/certify/short-form`에서 2025-07-01 선택 시 차단 확인

### 시나리오 5: 배너 상태 변화
1. [ ] 남은 일수 > 7일: 파란색 배너 확인
2. [ ] 관리자가 종료일을 7일 이내로 수정
3. [ ] 노란색 배너로 변경 확인, "마감 N일 전" 표시
4. [ ] 종료일을 과거로 수정
5. [ ] 빨간색 배너로 변경 확인, "종료됨" 표시

---

## 8️⃣ 예외 상황 테스트

### ✅ 잘못된 날짜 입력
- [ ] 시작일 > 종료일 입력 시 에러 표시
- [ ] 필수 필드 누락 시 제출 차단
- [ ] 잘못된 날짜 형식 입력 시 처리

### ✅ 권한 제어
- [ ] 비관리자가 `/admin/certifications` 접근 시 차단
- [ ] 비관리자가 `/api/admin/certifications/reset` 호출 시 403 에러
- [ ] 비관리자가 `/api/admin/periods/update` 호출 시 403 에러

### ✅ 동시성 처리
- [ ] 두 명의 관리자가 동시에 기수를 수정할 때 충돌 처리
- [ ] 활성 기수가 없을 때 인증 시도 처리

### ✅ 데이터 무결성
- [ ] certifications에 period_id가 null인 레코드 처리
- [ ] period_id가 참조하는 period가 삭제되었을 때 처리

---

## 9️⃣ 성능 테스트

### ✅ React Query 캐싱
- [ ] useActivePeriod가 5분간 캐시되는가?
- [ ] 불필요한 API 호출이 발생하지 않는가?
- [ ] refetch가 필요할 때만 데이터를 새로 가져오는가?

### ✅ 페이지 로딩 속도
- [ ] 배너가 페이지 로딩 속도에 영향을 주지 않는가?
- [ ] useActivePeriod 로딩 중에도 페이지가 정상 렌더링되는가?

---

## 🎯 테스트 완료 기준

다음 모든 항목이 체크되어야 테스트 통과:

1. [ ] 모든 데이터베이스 스키마가 올바르게 설정됨
2. [ ] 전체 리셋 기능이 정상 작동함
3. [ ] 인증 기간 검증이 프론트엔드와 백엔드 모두에서 작동함
4. [ ] UI에서 기간 외 인증이 차단됨
5. [ ] 관리자가 기수 기간을 수정할 수 있음
6. [ ] 수정 후 변경사항이 즉시 반영됨
7. [ ] 배너가 모든 페이지에서 올바르게 표시됨
8. [ ] 배너 색상이 상태에 따라 변경됨
9. [ ] 모든 통합 시나리오가 성공적으로 완료됨
10. [ ] 예외 상황이 적절히 처리됨

---

## 📊 테스트 결과 기록

### 테스트 수행 일시
- 날짜: YYYY-MM-DD
- 수행자: [이름]

### 전체 결과
- 총 테스트 항목: [N]개
- 통과: [N]개
- 실패: [N]개
- 보류: [N]개

### 주요 이슈
1. [이슈 설명]
2. [이슈 설명]

### 권장 사항
1. [권장 사항]
2. [권장 사항]

---

## 🔧 자동화 고려사항 (향후 개선)

현재는 수동 테스트 체크리스트로 검증하지만, 향후 다음과 같은 자동화를 고려할 수 있습니다:

### E2E 테스트 프레임워크
- **Cypress** 또는 **Playwright** 설치
- 주요 시나리오를 자동화된 테스트로 변환
- CI/CD 파이프라인에 통합

### 단위 테스트
- `isWithinActivePeriod` 함수 단위 테스트
- API 라우트 통합 테스트
- React 컴포넌트 테스트

### 데이터베이스 테스트
- Supabase 테스트 환경 구성
- 마이그레이션 자동화
- RLS 정책 테스트

---

## 📝 결론

이 체크리스트는 T-013부터 T-018까지 구현된 모든 기능이 올바르게 통합되어 작동하는지 검증하기 위한 것입니다. 모든 항목이 체크되면 기수별 인증 기간 관리 기능이 프로덕션 환경에서 안전하게 사용될 수 있습니다.

