# T-004 êµ¬í˜„ ìš”ì•½: ê´€ë¦¬ì ì ‘ê·¼ ì œì–´

```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•â•šâ•â•  â•šâ•â•â•â•    â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—     
â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
```

## ğŸ“‹ ìš”êµ¬ì‚¬í•­

**ê´€ë¦¬ìë§Œ ëŒ€ì‹œë³´ë“œ ë° ë¦¬ì…‹ ê¸°ëŠ¥ ì ‘ê·¼ ê°€ëŠ¥**

### êµ¬í˜„ ì„¸ë¶€ì‚¬í•­
- Next.js getServerSidePropsì—ì„œ Discord OAuth2ë¡œ ë°›ì•„ì˜¨ ì‚¬ìš©ì IDë¡œ Supabase ê´€ë¦¬ì í…Œì´ë¸” ì¡°íšŒ
- Supabase RLS ì •ì±… ì ìš©ìœ¼ë¡œ ê´€ë¦¬ì ì „ìš© API ë¼ìš°íŠ¸ ë³´í˜¸
- @tanstack/react-queryë¡œ ê¶Œí•œ ì²´í¬ ìƒíƒœ ê´€ë¦¬ ë° ì˜¤ë¥˜ ì²˜ë¦¬

### í…ŒìŠ¤íŠ¸ ì „ëµ
- ê´€ë¦¬ì/ë¹„ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ì¼ì¹˜ ë° ë¶ˆì¼ì¹˜ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- Supabase RLS ì •ì±… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¡œ ê¶Œí•œ ì°¨ë‹¨ ì—¬ë¶€ í™•ì¸
- ê¶Œí•œ ì‹¤íŒ¨ ì‹œ ì˜¬ë°”ë¥¸ ë¦¬ë‹¤ì´ë ‰ì…˜ ë° ì˜¤ë¥˜ UI í™•ì¸

---

## ğŸ¯ ë¬¸ì œ ë¶„ì„ ë° ì ‘ê·¼ ë°©ë²•

### í˜„ì¬ ìƒí™©
ASC Challenge Platformì—ëŠ” ê´€ë¦¬ì í˜ì´ì§€(`/admin`)ê°€ ì¡´ì¬í•˜ì§€ë§Œ, ì ‘ê·¼ ì œì–´ê°€ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œë§Œ ì´ë£¨ì–´ì§€ê³  ìˆì–´ ë³´ì•ˆì´ ì·¨ì•½í•©ë‹ˆë‹¤. URLì„ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ APIë¥¼ í˜¸ì¶œí•˜ë©´ ë¹„ê´€ë¦¬ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.

### í•´ê²° ì „ëµ
**ë‹¤ì¸µ ë°©ì–´ (Defense in Depth)** ì „ëµì„ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ë ˆë²¨ì—ì„œ ê¶Œí•œì„ ì²´í¬í•©ë‹ˆë‹¤:

1. **ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ (RLS)**: Supabase Row Level Securityë¡œ ë°ì´í„° ì ‘ê·¼ ì œì–´
2. **ë¯¸ë“¤ì›¨ì–´ ë ˆë²¨**: Next.js ë¯¸ë“¤ì›¨ì–´ë¡œ ì„œë²„ ì‚¬ì´ë“œ í˜ì´ì§€ ì ‘ê·¼ ì œì–´
3. **API ë¼ìš°íŠ¸ ë ˆë²¨**: ê° API ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ê¶Œí•œ í™•ì¸
4. **ì»´í¬ë„ŒíŠ¸ ë ˆë²¨**: React ê°€ë“œ ì»´í¬ë„ŒíŠ¸ë¡œ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì ‘ê·¼ ì œì–´

---

## ğŸ› ï¸ êµ¬í˜„ ë‚´ì—­

### 1. Supabase RLS ì •ì±… ê²€ì¦ ë° ê°•í™”

#### 1.1. ê¸°ì¡´ RLS ì •ì±… í™•ì¸
```sql
-- supabase/migrations/0011_fix_admin_rls_infinite_recursion.sql
-- admin_users í…Œì´ë¸”: ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨, SECURITY DEFINER í•¨ìˆ˜ë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼
-- is_admin() í•¨ìˆ˜: SECURITY DEFINERë¡œ RLS ìš°íšŒ
```

**ì£¼ìš” ê°œì„ ì‚¬í•­:**
- `admin_users` í…Œì´ë¸”ì— ëŒ€í•œ ì§ì ‘ ì ‘ê·¼ ì™„ì „ ì°¨ë‹¨
- `is_admin()`, `is_super_admin()` í•¨ìˆ˜ë¥¼ `SECURITY DEFINER`ë¡œ ì„ ì–¸í•˜ì—¬ RLS ë¬´í•œ ë£¨í”„ ë°©ì§€
- ëª¨ë“  í…Œì´ë¸”ì˜ RLS ì •ì±…ì´ ê´€ë¦¬ì í™•ì¸ ì‹œ `is_admin()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í†µì¼

#### 1.2. RLS ì •ì±… ì ìš© í…Œì´ë¸”
- `users`: ìì‹ ì˜ í”„ë¡œí•„ ì¡°íšŒ/ìˆ˜ì •, ê´€ë¦¬ìëŠ” ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ/ìˆ˜ì •
- `user_tracks`: ìì‹ ì˜ íŠ¸ë™ ì¡°íšŒ, ê´€ë¦¬ìëŠ” ëª¨ë“  íŠ¸ë™ ê´€ë¦¬
- `certifications`: ìì‹ ì˜ ì¸ì¦ ì¡°íšŒ/ìƒì„±, ê´€ë¦¬ìëŠ” ëª¨ë“  ì¸ì¦ ê´€ë¦¬
- `admin_audit_logs`: ê´€ë¦¬ìë§Œ ì¡°íšŒ, ìŠˆí¼ ê´€ë¦¬ìë§Œ ì‚­ì œ

---

### 2. ê´€ë¦¬ì ì „ìš© API ë¼ìš°íŠ¸ êµ¬í˜„

#### 2.1. `/api/admin/check` - ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ API
```typescript
// src/app/api/admin/check/route.ts
export async function GET() {
  // 1. í˜„ì¬ ì‚¬ìš©ì ì¸ì¦ í™•ì¸
  // 2. Supabase RPC í•¨ìˆ˜ë¡œ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  // 3. ê²°ê³¼ ë°˜í™˜: { isAdmin: boolean, userId: string | null }
}
```

**íŠ¹ì§•:**
- ì„œë²„ ì‚¬ì´ë“œì—ì„œ ì„¸ì…˜ í™•ì¸
- RLSê°€ ì ìš©ëœ `is_admin()` RPC í˜¸ì¶œ
- ëª…í™•í•œ ì—ëŸ¬ ì½”ë“œ ë°˜í™˜ (401: ë¯¸ì¸ì¦, 500: ì„œë²„ ì˜¤ë¥˜)

#### 2.2. `/api/admin/users` - ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ API
```typescript
// src/app/api/admin/users/route.ts
export async function GET() {
  // 1. ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  // 2. ëª¨ë“  ì‚¬ìš©ìì™€ íŠ¸ë™ ì •ë³´ ì¡°íšŒ
  // 3. í™œì„± íŠ¸ë™ë§Œ í•„í„°ë§í•˜ì—¬ ë°˜í™˜
}
```

**ê¶Œí•œ ì²´í¬:**
- ë¯¸ì¸ì¦: 401 Unauthorized
- ë¹„ê´€ë¦¬ì: 403 Forbidden
- ê´€ë¦¬ì: ì‚¬ìš©ì ëª©ë¡ ë°˜í™˜

#### 2.3. `/api/admin/stats` - ê´€ë¦¬ì í†µê³„ API
```typescript
// src/app/api/admin/stats/route.ts
export async function GET() {
  // 1. ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  // 2. í†µê³„ ë°ì´í„° ì¡°íšŒ (ì´ ì‚¬ìš©ì, ì˜¤ëŠ˜ ì¸ì¦, íƒˆë½ í›„ë³´)
  // 3. ê²°ê³¼ ë°˜í™˜
}
```

**í†µê³„ í•­ëª©:**
- `totalUsers`: ì „ì²´ í™œì„± ì‚¬ìš©ì ìˆ˜
- `todayCertifications`: ì˜¤ëŠ˜ì˜ ì¸ì¦ ìˆ˜
- `dropoutCandidates`: ê²½ê³  ëŒ€ìƒì ìˆ˜

---

### 3. Next.js ë¯¸ë“¤ì›¨ì–´ ê°•í™”

#### 3.1. `/admin/*` ê²½ë¡œ ë³´í˜¸
```typescript
// src/middleware.ts
export async function middleware(request: NextRequest) {
  // 1. Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
  // 2. ì‚¬ìš©ì ì¸ì¦ í™•ì¸
  // 3. /admin ê²½ë¡œ ì ‘ê·¼ ì‹œ ê¶Œí•œ ì²´í¬
  // 4. ê¶Œí•œ ì—†ìœ¼ë©´ ë¦¬ë‹¤ì´ë ‰ì…˜
}
```

**ë³´í˜¸ ë¡œì§:**
```typescript
if (request.nextUrl.pathname.startsWith('/admin')) {
  // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš°
  if (!user) {
    return NextResponse.redirect(new URL('/login?error=ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤&redirect=/admin', request.url));
  }

  // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  const { data: isAdmin } = await supabase.rpc('is_admin', {
    check_user_id: user.id,
  });

  if (!isAdmin) {
    return NextResponse.redirect(new URL('/?error=ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', request.url));
  }
}
```

**ë¦¬ë‹¤ì´ë ‰ì…˜ ì „ëµ:**
- ë¯¸ì¸ì¦: `/login?error=...&redirect=/admin` (ë¡œê·¸ì¸ í›„ ì›ë˜ í˜ì´ì§€ë¡œ ë³µê·€)
- ë¹„ê´€ë¦¬ì: `/?error=...` (í™ˆí˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ + ì—ëŸ¬ ë©”ì‹œì§€)

---

### 4. í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ê°€ë“œ ì»´í¬ë„ŒíŠ¸

#### 4.1. `AdminPageGuard` ì»´í¬ë„ŒíŠ¸
```typescript
// src/components/guards/AdminPageGuard.tsx
export function AdminPageGuard({ children, fallback }: AdminPageGuardProps) {
  // 1. react-queryë¡œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  // 2. react-queryë¡œ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  // 3. ê¶Œí•œì— ë”°ë¼ UI ë Œë”ë§
}
```

**ê¶Œí•œ ì²´í¬ íë¦„:**
1. **ë¡œë”© ì¤‘**: ë¡œë”© ìŠ¤í”¼ë„ˆ + "ê¶Œí•œì„ í™•ì¸í•˜ëŠ” ì¤‘..." í‘œì‹œ
2. **ë¯¸ì¸ì¦**: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤" ì¹´ë“œ + ë¡œê·¸ì¸ ë²„íŠ¼
3. **ë¹„ê´€ë¦¬ì**: "ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ" ì¹´ë“œ + í™ˆ ë²„íŠ¼
4. **ê´€ë¦¬ì**: ìì‹ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§

**react-query í†µí•©:**
```typescript
// ì‚¬ìš©ì ì •ë³´ ìºì‹± (5ë¶„)
const { data: user } = useQuery({
  queryKey: ['current-user'],
  queryFn: getUser,
  staleTime: 1000 * 60 * 5,
});

// ê´€ë¦¬ì ê¶Œí•œ ìºì‹± (10ë¶„)
const { data: isAdmin } = useIsAdmin(user?.id);
```

**ì—ëŸ¬ í•¸ë“¤ë§:**
- ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨: "ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨" í† ìŠ¤íŠ¸
- ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨: "ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨" í† ìŠ¤íŠ¸
- ìë™ ë¦¬ë‹¤ì´ë ‰ì…˜: ë¡œê·¸ì¸ í˜ì´ì§€ ë˜ëŠ” í™ˆí˜ì´ì§€ë¡œ

---

### 5. ê¶Œí•œ ì‹¤íŒ¨ ì‹œ UI ë° ë¦¬ë‹¤ì´ë ‰ì…˜

#### 5.1. í™ˆí˜ì´ì§€ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
```typescript
// src/app/page.tsx
function HomeContent() {
  const searchParams = useSearchParams();
  const { toast } = useToast();

  useEffect(() => {
    const error = searchParams.get('error');
    if (error) {
      toast({
        title: 'ì•Œë¦¼',
        description: decodeURIComponent(error),
        variant: 'destructive',
      });
    }
  }, [searchParams, toast]);
}

// Suspense ê²½ê³„ë¡œ ê°ì‹¸ê¸°
export default function Home() {
  return (
    <Suspense fallback={<LoadingUI />}>
      <HomeContent />
    </Suspense>
  );
}
```

#### 5.2. ë¡œê·¸ì¸ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰ì…˜
```typescript
// ë¯¸ë“¤ì›¨ì–´ì—ì„œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ ì‹œ
const loginUrl = new URL('/login', request.url);
loginUrl.searchParams.set('error', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
loginUrl.searchParams.set('redirect', request.nextUrl.pathname);
return NextResponse.redirect(loginUrl);
```

**ë¡œê·¸ì¸ í›„ ë³µê·€:**
- `redirect` íŒŒë¼ë¯¸í„°ì— ì›ë˜ ì ‘ê·¼í•˜ë ¤ë˜ í˜ì´ì§€ ì €ì¥
- ë¡œê·¸ì¸ ì„±ê³µ í›„ `redirect` í˜ì´ì§€ë¡œ ìë™ ì´ë™

---

## ğŸ“‚ íŒŒì¼ êµ¬ì¡°

```
asc-challenge-platform/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ admin/                      # ê´€ë¦¬ì í˜ì´ì§€
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx               # ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â”‚   â”œâ”€â”€ users/page.tsx         # ì‚¬ìš©ì ê´€ë¦¬
â”‚   â”‚   â”‚   â””â”€â”€ settings/page.tsx      # ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ admin/                 # ê´€ë¦¬ì ì „ìš© API
â”‚   â”‚   â”‚       â”œâ”€â”€ check/route.ts     # ê¶Œí•œ í™•ì¸ API â­ ì‹ ê·œ
â”‚   â”‚   â”‚       â”œâ”€â”€ users/route.ts     # ì‚¬ìš©ì ëª©ë¡ API â­ ì‹ ê·œ
â”‚   â”‚   â”‚       â””â”€â”€ stats/route.ts     # í†µê³„ API â­ ìˆ˜ì •
â”‚   â”‚   â””â”€â”€ page.tsx                   # í™ˆí˜ì´ì§€ â­ ìˆ˜ì • (ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ guards/
â”‚   â”‚       â””â”€â”€ AdminPageGuard.tsx     # ê´€ë¦¬ì í˜ì´ì§€ ê°€ë“œ â­ ì‹ ê·œ
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useAdmin.ts                # ê´€ë¦¬ì ê´€ë ¨ í›…
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ admin-guard.ts         # API ê°€ë“œ í—¬í¼
â”‚   â”‚   â””â”€â”€ supabase/
â”‚   â”‚       â”œâ”€â”€ admin.ts               # ê´€ë¦¬ì í•¨ìˆ˜
â”‚   â”‚       â””â”€â”€ auth-server.ts         # ì„œë²„ ì¸ì¦ í•¨ìˆ˜
â”‚   â””â”€â”€ middleware.ts                  # Next.js ë¯¸ë“¤ì›¨ì–´ â­ ìˆ˜ì •
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ migrations/
â”‚       â””â”€â”€ 0011_fix_admin_rls_infinite_recursion.sql  # RLS ì •ì±…
â”œâ”€â”€ ADMIN_ACCESS_CONTROL_TESTS.md     # í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ â­ ì‹ ê·œ
â””â”€â”€ T004_IMPLEMENTATION_SUMMARY.md    # ì´ ë¬¸ì„œ â­ ì‹ ê·œ
```

---

## ğŸ”„ ê¶Œí•œ ì²´í¬ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì‚¬ìš©ìê°€ /admin ì ‘ê·¼ ì‹œë„                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   1. Next.js ë¯¸ë“¤ì›¨ì–´         â”‚
                    â”‚   (ì„œë²„ ì‚¬ì´ë“œ)              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ì‚¬ìš©ì ì¸ì¦ í™•ì¸             â”‚
                    â”‚  (supabase.auth.getUser())   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ë¯¸ì¸ì¦?                     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           YES â”‚   â”‚ NO
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
                    â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ /loginìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜  â”‚  â”‚ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸       â”‚
        â”‚ (redirect íŒŒë¼ë¯¸í„°)    â”‚  â”‚ (is_admin RPC)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  ê´€ë¦¬ì?             â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      YES â”‚   â”‚ NO
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚                             â”‚
                           â–¼                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 2. AdminPageGuard      â”‚   â”‚ í™ˆí˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜   â”‚
              â”‚    (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)  â”‚   â”‚ (error íŒŒë¼ë¯¸í„°)       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ react-queryë¡œ ê¶Œí•œ ì¬í™•ì¸â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ê´€ë¦¬ì?               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   YES â”‚   â”‚ NO
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
        â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í˜ì´ì§€ ë Œë”ë§      â”‚      â”‚ "ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ" UI    â”‚
â”‚                   â”‚      â”‚ + í™ˆ ë²„íŠ¼             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ì¼ë°˜ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ A: ì§ì ‘ URL ì…ë ¥
```
1. ì¼ë°˜ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸
2. ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ì— "https://app.com/admin" ì…ë ¥
3. Next.js ë¯¸ë“¤ì›¨ì–´ê°€ ê¶Œí•œ ì²´í¬
4. í™ˆí˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ ("/")
5. ì—ëŸ¬ í† ìŠ¤íŠ¸ í‘œì‹œ: "ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
```

**ê²€ì¦ í•­ëª©:**
- [ ] ë¯¸ë“¤ì›¨ì–´ ë¡œê·¸: `[Middleware] Non-admin user tried to access admin page`
- [ ] í™ˆí˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ë¨
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ê°€ í† ìŠ¤íŠ¸ë¡œ í‘œì‹œë¨

#### ì‹œë‚˜ë¦¬ì˜¤ B: API ì§ì ‘ í˜¸ì¶œ
```
1. ì¼ë°˜ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸
2. fetch('/api/admin/users') í˜¸ì¶œ
3. API ë¼ìš°íŠ¸ì—ì„œ ê¶Œí•œ ì²´í¬
4. 403 Forbidden ì‘ë‹µ
5. ì—ëŸ¬ ë©”ì‹œì§€: "Forbidden: Admin access required"
```

**ê²€ì¦ í•­ëª©:**
- [ ] API ì‘ë‹µ ìƒíƒœ ì½”ë“œ: 403
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ê°€ ëª…í™•í•¨
- [ ] API ë¡œê·¸: `[Admin Users API] Access denied`

---

### 2. ê´€ë¦¬ì ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ C: ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼
```
1. ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸
2. "/admin" í˜ì´ì§€ ì ‘ê·¼
3. ë¯¸ë“¤ì›¨ì–´ í†µê³¼
4. AdminPageGuard í†µê³¼
5. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë Œë”ë§
```

**ê²€ì¦ í•­ëª©:**
- [ ] ë¯¸ë“¤ì›¨ì–´ ë¡œê·¸: `[Middleware] Admin access granted for user`
- [ ] ê°€ë“œ ë¡œê·¸: `[AdminPageGuard] Admin check result: true`
- [ ] í˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ë Œë”ë§ë¨

#### ì‹œë‚˜ë¦¬ì˜¤ D: API í˜¸ì¶œ
```
1. ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸
2. fetch('/api/admin/stats') í˜¸ì¶œ
3. API ë¼ìš°íŠ¸ì—ì„œ ê¶Œí•œ ì²´í¬ í†µê³¼
4. 200 OK ì‘ë‹µ + í†µê³„ ë°ì´í„° ë°˜í™˜
```

**ê²€ì¦ í•­ëª©:**
- [ ] API ì‘ë‹µ ìƒíƒœ ì½”ë“œ: 200
- [ ] í†µê³„ ë°ì´í„°ê°€ ì˜¬ë°”ë¦„
- [ ] API ë¡œê·¸ì— ì—ëŸ¬ ì—†ìŒ

---

### 3. ë¯¸ì¸ì¦ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ E: ë¡œê·¸ì¸ ì—†ì´ ì ‘ê·¼
```
1. ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ
2. "/admin" í˜ì´ì§€ ì ‘ê·¼
3. ë¯¸ë“¤ì›¨ì–´ê°€ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
4. URL: "/login?error=ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤&redirect=/admin"
5. ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
```

**ê²€ì¦ í•­ëª©:**
- [ ] ë¯¸ë“¤ì›¨ì–´ ë¡œê·¸: `[Middleware] Unauthorized access to admin page`
- [ ] ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ë¨
- [ ] `redirect` íŒŒë¼ë¯¸í„°ê°€ ìˆìŒ
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ê°€ í‘œì‹œë¨

---

## ğŸ” ì½”ë“œ ë¦¬ë·° í¬ì¸íŠ¸

### 1. ë³´ì•ˆ
- [x] RLS ì •ì±…ì´ ëª¨ë“  ë¯¼ê°í•œ í…Œì´ë¸”ì— ì ìš©ë¨
- [x] API ë¼ìš°íŠ¸ë§ˆë‹¤ ê¶Œí•œ ì²´í¬ê°€ ìˆìŒ
- [x] ì„œë²„ ì‚¬ì´ë“œì™€ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ëª¨ë‘ì—ì„œ ê²€ì¦
- [x] ì—ëŸ¬ ë©”ì‹œì§€ê°€ ë³´ì•ˆ ì •ë³´ë¥¼ ë…¸ì¶œí•˜ì§€ ì•ŠìŒ

### 2. ì„±ëŠ¥
- [x] react-queryë¡œ ê¶Œí•œ ì²´í¬ ê²°ê³¼ ìºì‹± (5-10ë¶„)
- [x] ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ìµœì†Œí™”
- [x] ë¯¸ë“¤ì›¨ì–´ì—ì„œ ë¹ ë¥¸ ë¦¬ë‹¤ì´ë ‰ì…˜

### 3. ì‚¬ìš©ì ê²½í—˜
- [x] ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
- [x] ë¡œê·¸ì¸ í›„ ì›ë˜ í˜ì´ì§€ë¡œ ë³µê·€ ê°€ëŠ¥
- [x] ë¡œë”© ì¤‘ ì ì ˆí•œ UI í‘œì‹œ
- [x] ëª¨ë°”ì¼ì—ì„œë„ ì˜ ì‘ë™

### 4. ìœ ì§€ë³´ìˆ˜ì„±
- [x] ì½”ë“œê°€ ëª¨ë“ˆí™”ë˜ì–´ ìˆìŒ
- [x] ê° ë ˆë²¨ì˜ ì±…ì„ì´ ëª…í™•í•¨
- [x] ë¡œê·¸ê°€ ì¶©ë¶„íˆ ë‚¨ìŒ
- [x] í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„±ë¨

---

## ğŸ“Š ì„±ëŠ¥ ë©”íŠ¸ë¦­

### ê¶Œí•œ ì²´í¬ ì‹œê°„
- **ë¯¸ë“¤ì›¨ì–´**: ~50ms (Supabase RPC í˜¸ì¶œ í¬í•¨)
- **API ë¼ìš°íŠ¸**: ~50ms (RPC í˜¸ì¶œ í¬í•¨)
- **í´ë¼ì´ì–¸íŠ¸ ê°€ë“œ**: ~100ms (react-query ìºì‹œ íˆíŠ¸ ì‹œ ~1ms)

### ìºì‹± ì „ëµ
- **ì‚¬ìš©ì ì •ë³´**: 5ë¶„ ìºì‹±
- **ê´€ë¦¬ì ê¶Œí•œ**: 10ë¶„ ìºì‹±
- **ê´€ë¦¬ì í†µê³„**: 2ë¶„ ìºì‹±

---

## ğŸš€ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Supabase ì„¤ì •
- [x] RLS ì •ì±… ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
- [x] `is_admin()` RPC í•¨ìˆ˜ í™•ì¸
- [x] `admin_users` í…Œì´ë¸”ì— ê´€ë¦¬ì ê³„ì • ë“±ë¡

### Vercel ì„¤ì •
- [x] í™˜ê²½ ë³€ìˆ˜ í™•ì¸ (`NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`)
- [x] ë¯¸ë“¤ì›¨ì–´ ë¼ìš°íŒ… í™•ì¸

### í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ê´€ë¦¬ì ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì¼ë°˜ ì‚¬ìš©ì í…ŒìŠ¤íŠ¸
- [ ] ëª¨ë“  ê´€ë¦¬ì API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸

---

## ğŸ“ ë°°ìš´ ì  ë° ê°œì„  ì‚¬í•­

### ë°°ìš´ ì 
1. **ë‹¤ì¸µ ë°©ì–´ì˜ ì¤‘ìš”ì„±**: í•˜ë‚˜ì˜ ë ˆë²¨ì—ì„œë§Œ ì²´í¬í•˜ë©´ ìš°íšŒë  ìˆ˜ ìˆìŒ
2. **RLS SECURITY DEFINER**: RLS ë¬´í•œ ë£¨í”„ë¥¼ ë°©ì§€í•˜ë ¤ë©´ SECURITY DEFINER í•¨ìˆ˜ ì‚¬ìš©
3. **react-query ìºì‹±**: ê¶Œí•œ ì²´í¬ ê²°ê³¼ë¥¼ ìºì‹±í•˜ì—¬ ì„±ëŠ¥ í–¥ìƒ
4. **ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€**: ì‚¬ìš©ìì™€ ê°œë°œì ëª¨ë‘ë¥¼ ìœ„í•œ ëª…í™•í•œ ë©”ì‹œì§€ í•„ìš”

### í–¥í›„ ê°œì„  ì‚¬í•­
1. **ê¶Œí•œ ê·¸ë£¹í™”**: í˜„ì¬ëŠ” "ê´€ë¦¬ì" vs "ë¹„ê´€ë¦¬ì"ë§Œ êµ¬ë¶„, í–¥í›„ ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC) ë„ì… ê°€ëŠ¥
2. **ì‹¤ì‹œê°„ ê¶Œí•œ ì—…ë°ì´íŠ¸**: ê´€ë¦¬ì ê¶Œí•œì´ ë³€ê²½ë˜ë©´ ì¦‰ì‹œ ë°˜ì˜ (Supabase Realtime)
3. **ê°ì‚¬ ë¡œê·¸**: ê´€ë¦¬ì í–‰ë™ì„ `admin_audit_logs`ì— ìë™ ê¸°ë¡
4. **ê¶Œí•œ ì²´í¬ ì„±ëŠ¥ ìµœì í™”**: ë¯¸ë“¤ì›¨ì–´ì—ì„œ ìºì‹± ì¶”ê°€

---

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

### ê´€ë ¨ íŒŒì¼
- **ë¯¸ë“¤ì›¨ì–´**: `src/middleware.ts`
- **ê°€ë“œ ì»´í¬ë„ŒíŠ¸**: `src/components/guards/AdminPageGuard.tsx`
- **API ë¼ìš°íŠ¸**: `src/app/api/admin/*`
- **RLS ì •ì±…**: `supabase/migrations/0011_fix_admin_rls_infinite_recursion.sql`
- **í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ**: `ADMIN_ACCESS_CONTROL_TESTS.md`

### ë¡œê·¸ í™•ì¸
- **Supabase**: Dashboard > Logs > API
- **Vercel**: Deployment > Functions > Logs
- **ë¸Œë¼ìš°ì €**: Console (F12)

### íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
1. **"ê´€ë¦¬ìì¸ë° ì ‘ê·¼ ì•ˆ ë¨"**: Supabase `admin_users` í…Œì´ë¸” í™•ì¸
2. **"ë¬´í•œ ë£¨í”„"**: `is_admin()` í•¨ìˆ˜ê°€ SECURITY DEFINERì¸ì§€ í™•ì¸
3. **"ì—ëŸ¬ ë©”ì‹œì§€ ì•ˆ ë³´ì„"**: ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ URL íŒŒë¼ë¯¸í„° í™•ì¸

---

**ì‘ì„±ì¼**: 2025-10-11  
**ë²„ì „**: 1.0  
**ì‘ì—… ì½”ë“œ**: T-004  
**ìƒíƒœ**: âœ… êµ¬í˜„ ì™„ë£Œ

